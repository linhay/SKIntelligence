## SKICLI 体验迭代（Round 12）

- 决策：按 Codex 体验报告第 3 条先做最小落地，不破坏兼容前提下新增 transport 分流子命令。
- 行动：
  - 新增 `ski acp client connect-stdio` 与 `ski acp client connect-ws`。
  - 抽取共享执行逻辑 `runACPClientConnect(...)`。
  - 新增进程测试 `testClientConnectStdioHelpHidesWSOnlyOptions`、`testClientConnectWSHelpHidesStdioOnlyOptions`。
- 验证：
  - `swift test --filter SKICLIProcessTests` 通过（33 passed, 0 failed）。
  - `./scripts/test_acp_gate.sh` 通过（211 passed, 1 skipped, 0 failed）。
- 风险与后续：
  - 旧命令 `acp client connect` 仍保留，后续可评估逐步引导迁移并在稳定后收敛参数面。

## SKICLI 体验迭代（Round 13）

- 决策：按 codex 体验报告优先修复 `--json` 事件类型不一致问题，先做低风险高收益收口。
- 行动：
  - `ACPCLIOutputFormatter.promptResultJSON` 增加 `type: "prompt_result"`。
  - 新增/更新测试：
    - `SKICLITests.testPromptResultJSONPayloadShape`（断言 `type`）
    - `SKICLIProcessTests.testClientConnectViaStdioServeProcessJSONEmitsPromptResultType`（进程级验证）
- 验证：
  - 定向测试通过（formatter + process）。
  - `swift test --filter SKICLIProcessTests` 通过（34 passed, 0 failed）。
  - `./scripts/test_acp_gate.sh` 通过（212 passed, 1 skipped, 0 failed）。
- 风险与后续：
  - 仍待推进 codex 评审的其余两项：`request-timeout` 语义统一、会话复用（`--session-id`）。

## SKICLI 体验迭代（Round 14）

- 决策：优先收敛 `request-timeout` 语义，避免 `--request-timeout-ms 0` 触发“立即超时”的误伤行为。
- 行动：
  - `connect-stdio/connect-ws/connect` 的 `--request-timeout-ms` 改为默认 `60000`。
  - 统一语义为 `0 disables`，并在帮助文案显式标注。
  - `runACPClientConnect(...)` 中将 `requestTimeoutMS == 0` 映射为 `nil`（禁用超时）。
  - 新增 3 条进程测试覆盖 help 文案与 `0` 语义。
- 验证：
  - 定向测试通过。
  - `swift test --filter SKICLIProcessTests` 通过（37 passed, 0 failed）。
  - `./scripts/test_acp_gate.sh` 通过（215 passed, 1 skipped, 0 failed）。
- 风险与后续：
  - 下一优先项：会话复用能力（`--session-id` / `--reuse-session`），减少每次强制 `session/new`。

## SKICLI 体验迭代（Round 15）

- 决策：推进会话复用最小能力，优先以 `--session-id` 打通 CLI 业务链路。
- 行动：
  - `connect/connect-stdio/connect-ws` 新增 `--session-id` 参数。
  - 空白 `--session-id` 输入校验（exit code 2）。
  - 共享执行逻辑支持“有 `session-id` 则跳过 `session/new`，直接 `session/prompt`”。
  - 新增进程测试覆盖 help 可发现性、空值校验、不存在 session 的失败路径。
- 验证：
  - 定向测试通过。
  - `swift test --filter SKICLIProcessTests` 通过（39 passed, 0 failed）。
  - `./scripts/test_acp_gate.sh` 通过（217 passed, 1 skipped, 0 failed）。
- 风险与后续：
  - 下一步可补 `session list/resume` 子命令，降低用户手工传 session-id 的成本。

## Round 16（codex-cli 体验闭环）
- 关键发现：`ski acp client connect-stdio` 在 `--cmd` 传命令名（如 `env` / `swift`）时运行期报错 `The file "xxx" doesn’t exist`，首用体验要求隐式“绝对路径”。
- 决策：将 stdio `--cmd` 语义升级为“命令名或路径均可”。
- 实施：
  - `ACPCLITransportFactory` 新增 `PATH` 解析；
  - 路径型命令增加可执行性校验；
  - 未命中命令前置返回 `invalidInput`（`--cmd was not found in PATH for stdio transport`）。
- 测试：
  - 新增 `SKICLITests.testACPClientConnectResolvesCommandFromPATHForStdio`；
  - 新增 `SKICLITests.testACPClientConnectRejectsUnknownCommandForStdio`；
  - 新增 `SKICLIProcessTests.testClientConnectViaStdioResolvesCmdFromPATH`；
  - `swift test --filter SKICLIProcessTests` 通过（40 passed, 0 failed）；
  - `./scripts/test_acp_gate.sh` 通过（220 passed, 1 skipped, 0 failed）。
- 文档：`docs-dev/features/CLI-Benchmark-Spec.md` 新增 PATH 解析验收场景；`docs-dev/dev/Codex-CLI-Experience-Report.md` 新增 Round 16。

## Round 17（codex-cli 体验闭环）
- 体验输入：继续按 `$codex-cli` 闭环执行，验证 Round 16 的 PATH 解析后续 UX。
- 关键发现：
  - 功能已可用（`--cmd swift` 成功）；
  - 但 `connect-stdio --help` 对 `--cmd` 仍无语义提示，用户不知道可直接传 PATH 命令名；
  - `codex exec --json` 出现 MCP/rollout 噪音日志（`IncompleteMessage` / `state db missing rollout path`），当前不影响任务执行。
- 决策：优先补齐 CLI 帮助可发现性，不在本仓库内处理 codex 外部日志问题。
- 实施：
  - `CLI.swift` 为 `connect-stdio/connect` 的 `--cmd` 增加 help：`Child executable path or command name in PATH`；
  - 新增 `SKICLIProcessTests.testClientConnectStdioHelpMentionsCmdCanUsePATH`；
  - 更新 `docs-dev/features/CLI-Benchmark-Spec.md` 场景 13。
- 验证：
  - 定向测试通过；
  - `swift test --filter SKICLIProcessTests` 通过（41 passed, 0 failed）；
  - `./scripts/test_acp_gate.sh` 通过（221 passed, 1 skipped, 0 failed）。

## Round 18（codex-cli 体验闭环）
- 关键发现：`connect-stdio` 误用 `--args --transport` 仅提示 `Missing value`，但 help 未给 `--args=--flag` 规则，修复路径不可发现。
- 决策：将 `connect-stdio` 的帮助体验与 `connect` 对齐，在 help 层提前给出 option-like 参数传递规则。
- 实施：
  - `ACPClientConnectStdioCommand` 新增 `discussion` 示例与 Note；
  - 新增 `SKICLIProcessTests.testClientConnectStdioHelpMentionsArgsEqualsForOptionLikeChildArgs`；
  - `docs-dev/features/CLI-Benchmark-Spec.md` 新增场景 14。
- 验证：
  - 定向测试通过；
  - `swift test --filter SKICLIProcessTests` 通过（42 passed, 0 failed）；
  - `./scripts/test_acp_gate.sh` 通过（222 passed, 1 skipped, 0 failed）。
- 额外观察：`codex exec --json` 仍伴随 refresh token 与 MCP rollout 噪音日志；当前不阻塞本仓库闭环。
